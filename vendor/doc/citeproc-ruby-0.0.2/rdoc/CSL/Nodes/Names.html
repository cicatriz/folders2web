<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <title>Class: CSL::Nodes::Names</title>

  <link rel="stylesheet" href="../../rdoc.css" type="text/css" media="screen" />

  <script src="../../js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../js/thickbox-compressed.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../js/quicksearch.js" type="text/javascript" charset="utf-8"></script>
  <script src="../../js/darkfish.js" type="text/javascript" charset="utf-8"></script>

</head>
<body id="top" class="class">

  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../../index.html">Home</a>
          <a href="../../index.html#classes">Classes</a>
          <a href="../../index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="../../lib/csl/nodes_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/csl/nodes.rb">lib/csl/nodes.rb</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">
      
      <!-- Parent Class -->
      <div id="parent-class-section" class="section">
        <h3 class="section-header">Parent</h3>
        
        <p class="link"><a href="Node.html">CSL::Nodes::Node</a></p>
        
      </div>
      

      

      

      
      <!-- Method Quickref -->
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-i-collect_names">#collect_names</a></li>
          
          <li><a href="#method-i-inherit_attributes">#inherit_attributes</a></li>
          
          <li><a href="#method-i-prefix_label-3F">#prefix_label?</a></li>
          
          <li><a href="#method-i-process">#process</a></li>
          
        </ul>
      </div>
      

      
    </div>

    <div id="project-metadata">
      
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="../../images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="../../CSL.html">CSL</a></li>
        
          <li><a href="../../CSL/Bibliography.html">CSL::Bibliography</a></li>
        
          <li><a href="../../CSL/Citation.html">CSL::Citation</a></li>
        
          <li><a href="../../CSL/Key.html">CSL::Key</a></li>
        
          <li><a href="../../CSL/Locale.html">CSL::Locale</a></li>
        
          <li><a href="../../CSL/Node.html">CSL::Node</a></li>
        
          <li><a href="../../CSL/Nodes.html">CSL::Nodes</a></li>
        
          <li><a href="../../CSL/Nodes/Choose.html">CSL::Nodes::Choose</a></li>
        
          <li><a href="../../CSL/Nodes/ConditionalBlock.html">CSL::Nodes::ConditionalBlock</a></li>
        
          <li><a href="../../CSL/Nodes/Date.html">CSL::Nodes::Date</a></li>
        
          <li><a href="../../CSL/Nodes/DatePart.html">CSL::Nodes::DatePart</a></li>
        
          <li><a href="../../CSL/Nodes/EtAl.html">CSL::Nodes::EtAl</a></li>
        
          <li><a href="../../CSL/Nodes/Group.html">CSL::Nodes::Group</a></li>
        
          <li><a href="../../CSL/Nodes/Label.html">CSL::Nodes::Label</a></li>
        
          <li><a href="../../CSL/Nodes/Layout.html">CSL::Nodes::Layout</a></li>
        
          <li><a href="../../CSL/Nodes/Macro.html">CSL::Nodes::Macro</a></li>
        
          <li><a href="../../CSL/Nodes/Name.html">CSL::Nodes::Name</a></li>
        
          <li><a href="../../CSL/Nodes/NamePart.html">CSL::Nodes::NamePart</a></li>
        
          <li><a href="../../CSL/Nodes/Names.html">CSL::Nodes::Names</a></li>
        
          <li><a href="../../CSL/Nodes/Node.html">CSL::Nodes::Node</a></li>
        
          <li><a href="../../CSL/Nodes/Number.html">CSL::Nodes::Number</a></li>
        
          <li><a href="../../CSL/Nodes/Substitute.html">CSL::Nodes::Substitute</a></li>
        
          <li><a href="../../CSL/Nodes/Text.html">CSL::Nodes::Text</a></li>
        
          <li><a href="../../CSL/Renderer.html">CSL::Renderer</a></li>
        
          <li><a href="../../CSL/Sort.html">CSL::Sort</a></li>
        
          <li><a href="../../CSL/Style.html">CSL::Style</a></li>
        
          <li><a href="../../CSL/Term.html">CSL::Term</a></li>
        
          <li><a href="../../CiteProc.html">CiteProc</a></li>
        
          <li><a href="../../CiteProc/Bibliography.html">CiteProc::Bibliography</a></li>
        
          <li><a href="../../CiteProc/CitationData.html">CiteProc::CitationData</a></li>
        
          <li><a href="../../CiteProc/Date.html">CiteProc::Date</a></li>
        
          <li><a href="../../CiteProc/Format.html">CiteProc::Format</a></li>
        
          <li><a href="../../CiteProc/Format/Default.html">CiteProc::Format::Default</a></li>
        
          <li><a href="../../CiteProc/Format/Html.html">CiteProc::Format::Html</a></li>
        
          <li><a href="../../CiteProc/Formatter.html">CiteProc::Formatter</a></li>
        
          <li><a href="../../CiteProc/Item.html">CiteProc::Item</a></li>
        
          <li><a href="../../CiteProc/Name.html">CiteProc::Name</a></li>
        
          <li><a href="../../CiteProc/Processor.html">CiteProc::Processor</a></li>
        
          <li><a href="../../CiteProc/Selector.html">CiteProc::Selector</a></li>
        
          <li><a href="../../CiteProc/Variable.html">CiteProc::Variable</a></li>
        
          <li><a href="../../Support.html">Support</a></li>
        
          <li><a href="../../Support/Attributes.html">Support::Attributes</a></li>
        
          <li><a href="../../Support/Attributes/ClassMethods.html">Support::Attributes::ClassMethods</a></li>
        
          <li><a href="../../Support/Tree.html">Support::Tree</a></li>
        
          <li><a href="../../Support/Tree/ClassMethods.html">Support::Tree::ClassMethods</a></li>
        
          <li><a href="../../Extensions.html">Extensions</a></li>
        
          <li><a href="../../Extensions/Core.html">Extensions::Core</a></li>
        
          <li><a href="../../Extensions/Core/Numbers.html">Extensions::Core::Numbers</a></li>
        
          <li><a href="../../Fixnum.html">Fixnum</a></li>
        
          <li><a href="../../Kernel.html">Kernel</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    <h1 class="class">CSL::Nodes::Names</h1>

    <div id="description" class="description">
      
<p>The cs:names element can be used to display the contents of one or more
name variables, each of which can contain multiple names (e.g. the “author”
variable will contain all the cited item’s author names). The variables to
be displayed are set with the variable attribute. If multiple variables are
selected (separated by single spaces, see example below), each variable is
independently rendered in the order specified, with one exception: if the
value of variable consists of “editor” and “translator” (in either order),
and if the contents of the two name variables is identical, then the
contents of only one name variable is rendered. In addition, the
“editor-translator” term is used if the cs:names element contains a
cs:label element, replacing the default “editor” and “translator” terms
(e.g., this might result in “Doe (editor &amp; translator)”. The delimiter
attribute may be set on cs:names to delimit the names of the different name
variables (e.g. the semicolon in “Doe (editor); Johnson (translator)”).</p>

<pre>&lt;names variable=&quot;editor translator&quot; delimiter=&quot;; &quot;&gt;
  &lt;name/&gt;
  &lt;label prefix=&quot; (&quot; suffix=&quot;)&quot;/&gt;
&lt;/names&gt;</pre>

<p>There are four child elements associated with the cs:names element:
cs:name, cs:et-al, cs:substitute and cs:label (all discussed below). In
addition, the cs:names element may carry the attributes for affixes,
display and formatting.</p>

    </div><!-- description -->

    
    
    
    <div id="5Buntitled-5D" class="documentation-section">
      

      

      

      

      <!-- Methods -->
      
      <div id="public-instance-method-details" class="method-section section">
        <h3 class="section-header">Public Instance Methods</h3>

      
        <div id="prefix_label-3F-method" class="method-detail ">
          <a name="method-i-prefix_label-3F"></a>

          
          <div class="method-heading">
            <span class="method-name">prefix_label?</span><span
              class="method-args">()</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="prefix_label-3F-source">
<pre>
<span class="ruby-comment"># File lib/csl/nodes.rb, line 1040</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">prefix_label?</span>
  <span class="ruby-identifier">children</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span> [<span class="ruby-constant">Label</span>, <span class="ruby-constant">Name</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">class</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span> }.<span class="ruby-identifier">compact</span> <span class="ruby-operator">==</span> [<span class="ruby-constant">Label</span>, <span class="ruby-constant">Name</span>]
<span class="ruby-keyword">end</span></pre>
            </div><!-- prefix_label-3F-source -->
            
          </div>

          

          
        </div><!-- prefix_label-3F-method -->

      
        <div id="process-method" class="method-detail ">
          <a name="method-i-process"></a>

          
          <div class="method-heading">
            <span class="method-name">process</span><span
              class="method-args">(data, processor)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="process-source">
<pre>
<span class="ruby-comment"># File lib/csl/nodes.rb, line 1044</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">processor</span>)
  <span class="ruby-identifier">names</span> = <span class="ruby-identifier">collect_names</span>(<span class="ruby-identifier">data</span>)
  
  <span class="ruby-identifier">count_only</span> = <span class="ruby-keyword">self</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">form</span> <span class="ruby-operator">==</span> <span class="ruby-string">'count'</span>
  
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">names</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">names</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:last</span>).<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">empty?</span>
  
    <span class="ruby-comment"># handle the editor-translator special case</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">names</span>.<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:first</span>).<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">join</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp">/editortranslator/</span>)
      <span class="ruby-identifier">editors</span> = <span class="ruby-identifier">names</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">==</span> <span class="ruby-string">'editor'</span> }
      <span class="ruby-identifier">translators</span> = <span class="ruby-identifier">names</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">name</span><span class="ruby-operator">|</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">==</span> <span class="ruby-string">'translator'</span> }
  
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">editors</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">sort</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">translators</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">sort</span>
        <span class="ruby-identifier">editors</span>[<span class="ruby-value">0</span>] = <span class="ruby-string">'editortranslator'</span>
        <span class="ruby-identifier">names</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">translators</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">names</span> = <span class="ruby-identifier">names</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">role</span>, <span class="ruby-identifier">names</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">processed</span> = []
      
      <span class="ruby-identifier">truncated</span> = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">truncate</span>(<span class="ruby-identifier">names</span>)

      <span class="ruby-keyword">unless</span> <span class="ruby-identifier">count_only</span>
        <span class="ruby-identifier">processed</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">process_names</span>(<span class="ruby-identifier">role</span>, <span class="ruby-identifier">truncated</span>, <span class="ruby-identifier">processor</span>)
      
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">names</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">truncated</span>.<span class="ruby-identifier">length</span>
          <span class="ruby-comment"># use delimiter before et al. if there is more than a single name; squeeze whitespace</span>
          <span class="ruby-identifier">others</span> = (<span class="ruby-identifier">et_al</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">localized_terms</span>(<span class="ruby-string">'et-al'</span>).<span class="ruby-identifier">to_s</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">et_al</span>.<span class="ruby-identifier">process</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">processor</span>))
          <span class="ruby-identifier">link</span> = (<span class="ruby-identifier">name</span>.<span class="ruby-identifier">et_al_use_first</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">delimiter_precedes_et_al?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">delimiter</span> <span class="ruby-operator">:</span> <span class="ruby-string">' '</span>)

          <span class="ruby-identifier">processed</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">link</span>, <span class="ruby-identifier">others</span>].<span class="ruby-identifier">join</span>.<span class="ruby-identifier">squeeze</span>(<span class="ruby-string">' '</span>)
        <span class="ruby-keyword">end</span>
      
        <span class="ruby-identifier">processed</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">prefix_label?</span> <span class="ruby-operator">?</span> <span class="ruby-value">:unshift</span> <span class="ruby-operator">:</span> <span class="ruby-value">:push</span>, <span class="ruby-identifier">label</span>.<span class="ruby-identifier">process_names</span>(<span class="ruby-identifier">role</span>, <span class="ruby-identifier">names</span>.<span class="ruby-identifier">length</span>, <span class="ruby-identifier">processor</span>)) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">label</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">processed</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">truncated</span>.<span class="ruby-identifier">length</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">processed</span>.<span class="ruby-identifier">join</span>
    <span class="ruby-keyword">end</span>
    
    <span class="ruby-identifier">count_only</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">names</span>.<span class="ruby-identifier">inject</span>(<span class="ruby-value">0</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span><span class="ruby-operator">|</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">to_i</span> }.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">names</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">delimiter</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">count_only</span> <span class="ruby-operator">?</span> <span class="ruby-string">'0'</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">substitute</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-string">''</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">substitute</span>.<span class="ruby-identifier">process</span>(<span class="ruby-identifier">data</span>, <span class="ruby-identifier">processor</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Exception</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
  <span class="ruby-identifier">handle_processing_error</span>(<span class="ruby-identifier">e</span>, <span class="ruby-identifier">data</span>, <span class="ruby-identifier">processor</span>)        
<span class="ruby-keyword">end</span></pre>
            </div><!-- process-source -->
            
          </div>

          

          
        </div><!-- process-method -->

      
      </div><!-- public-instance-method-details -->
    
      <div id="protected-instance-method-details" class="method-section section">
        <h3 class="section-header">Protected Instance Methods</h3>

      
        <div id="collect_names-method" class="method-detail ">
          <a name="method-i-collect_names"></a>

          
          <div class="method-heading">
            <span class="method-name">collect_names</span><span
              class="method-args">(item)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>@returns a list of all name variables covered by this node; each list is
wrapped in a list containing the lists role (e.g., ‘editor’) followed by
the list proper.</p>
            

            
            <div class="method-source-code" id="collect_names-source">
<pre>
<span class="ruby-comment"># File lib/csl/nodes.rb, line 1101</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">collect_names</span>(<span class="ruby-identifier">item</span>)
  <span class="ruby-keyword">return</span> [] <span class="ruby-keyword">unless</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">variable?</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">variable</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/\s+/</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">variable</span><span class="ruby-operator">|</span> [<span class="ruby-identifier">variable</span>, (<span class="ruby-identifier">item</span>[<span class="ruby-identifier">variable</span>] <span class="ruby-operator">||</span> []).<span class="ruby-identifier">map</span>(&amp;<span class="ruby-value">:clone</span>)] }
<span class="ruby-keyword">end</span></pre>
            </div><!-- collect_names-source -->
            
          </div>

          

          
        </div><!-- collect_names-method -->

      
        <div id="inherit_attributes-method" class="method-detail ">
          <a name="method-i-inherit_attributes"></a>

          
          <div class="method-heading">
            <span class="method-name">inherit_attributes</span><span
              class="method-args">(node)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="inherit_attributes-source">
<pre>
<span class="ruby-comment"># File lib/csl/nodes.rb, line 1106</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">inherit_attributes</span>(<span class="ruby-identifier">node</span>)
  <span class="ruby-identifier">inherit_attributes_from</span>(<span class="ruby-identifier">node</span>, [<span class="ruby-string">'citation'</span>, <span class="ruby-string">'bibliography'</span>, <span class="ruby-string">'style'</span>], [<span class="ruby-string">'delimiter'</span>], <span class="ruby-string">'names-'</span>)
<span class="ruby-keyword">end</span></pre>
            </div><!-- inherit_attributes-source -->
            
          </div>

          

          
        </div><!-- inherit_attributes-method -->

      
      </div><!-- protected-instance-method-details -->
    
    </div><!-- 5Buntitled-5D -->
  

  </div><!-- documentation -->

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>

</body>
</html>

